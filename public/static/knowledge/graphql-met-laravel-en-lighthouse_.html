<!doctype html>
<html lang="nl">

<head>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1T344V7V5E"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-1T344V7V5E');
    </script>
    <!-- Leadinfo tracking code -->
    <script>
    (function(l,e,a,d,i,n,f,o){if(!l[i]){l.GlobalLeadinfoNamespace=l.GlobalLeadinfoNamespace||[];
    l.GlobalLeadinfoNamespace.push(i);l[i]=function(){(l[i].q=l[i].q||[]).push(arguments)};l[i].t=l[i].t||n;
    l[i].q=l[i].q||[];o=e.createElement(a);f=e.getElementsByTagName(a)[0];o.async=1;o.src=d;f.parentNode.insertBefore(o,f);}
    }(window,document,'script','https://cdn.leadinfo.net/ping.js','leadinfo','LI-643558C020FD3'));
    </script>
    <script src="https://cdn.usefathom.com/script.js" data-site="XTVPLNKC" defer></script>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    <title>GraphQL met Laravel en Lighthouse - Dutch Laravel Foundation</title>
    
    
        <meta name="description" content="De kennis- en brancheorganisatie voor Laravel developers"/>
    
    
    
        <meta name="keywords" content="Laravel, PHP, Larafest, Taylor Otwell, Dutch Laravel Foundation, DLF, kennisorganisatie"/>
    
    <meta property="og:title" content="Dutch Laravel Foundation" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dutchlaravelfoundation.nl/knowledge/graphql-met-laravel-en-lighthouse" />
    
    
        <meta property="og:description" content="De kennis- en brancheorganisatie voor Laravel developers">
    
    
    <meta property="og:image" content="https://dutchlaravelfoundation.nl/og-image.png" />
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://use.typekit.net/oap5ojy.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/tailwind.css?id=b1764481d81a045beb0ba72731a034e9">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
</head>

<body class="font-sans leading-normal bg-white text-primary-text">
    <div class="frontend relative page-graphql-met-laravel-en-lighthouse">
        


<script>
// Menu toggle
function isiOS() {
    return (
        ['iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'].includes(navigator.platform) ||
        (navigator.userAgent.includes('Mac') && 'ontouchend' in document)
    );
}

function menu() {
    return {
        open: false,
        disabled: true,
        init() {
            this.disabled = false;
        },
        toggleMenu() {
            const content = document.querySelector('.frontend');
            this.disabled = true;
            this.open = !this.open;
            if (this.open === true) {
                content.style.position = 'fixed';
                content.style.top = `-${window.pageYOffset}px`;
                // Fixes bug in Safari iOS 15.2 where screen height is not fully filled due to empty space address bar on bottom
                if(isiOS() === true) document.documentElement.style.height = window.innerHeight + 'px';
            } else {
                content.style.removeProperty('position');
                content.style.removeProperty('top');
                window.scrollTo(0, window.pageYOffset);
                if(isiOS() === true) document.documentElement.style.removeProperty('height');
            }
            this.disabled = false;
        },
    };
}
</script>

<header class="fixed top-0 left-0 w-screen z-[999] xl:bg-white">

    
    <div class="container flex-col items-center justify-center hidden p-10 pb-4 mx-auto xl:flex">
        <nav class="hidden w-full h-20 space-x-8 align-middle animated xl:flex" x-cloak>
            




    
        <a href="https://dutchlaravelfoundation.nl" class="flex grow "><img class="h-full max-h-full" src="/assets/img/logo.svg" alt="Home"></a>
    

    
        
        
        <a href="/wat-is-laravel"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Wat is Laravel?</a>
    

    
        
        
        <a href="/over-ons"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Over ons</a>
    

    
        
        
        <a href="/leden"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Onze leden</a>
    

    
        
        
        <a href="/cases"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Cases</a>
    

    
        
        
        <a href="/insights"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Insights</a>
    

    
        
        
        <a href="/agenda"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Agenda</a>
    

    
        
        
        <a href="/contact"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Contact</a>
    

    
        
        
        <a href="/lid-worden"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent ">Lid worden</a>
    

        </nav>
    </div>

    
    
    <div class="relative xl:hidden js-alpine-init bg-white pb-6" x-data="menu()" x-init="init()" x-cloak role="navigation">
        <div class="flex flex-row items-start justify-between w-full px-6 pt-6 pb-0 mx-auto xl:pt-10">
            <a href="/" class="flex justify-start w-full"><img class="max-w-full max-h-[3rem] xl:max-h-full" src="/assets/img/logo.svg" alt="Home"></a>
            
            <button class="z-[999] absolute top-7 right-8 xl:right-20 xl:top-[3rem] h-[2.4rem] w-[2.5rem] cursor-pointer" @click="toggleMenu()" disabled x-bind:disabled="disabled">
                <div class="relative focus:outline-none">
                    <div class="absolute block w-[4rem]">
                        <span aria-hidden="true" class="block absolute h-[0.2rem] w-[2.5rem] bg-tertiary-dark transform transition rounded-full duration-300 ease-in-out" :class="{'rotate-45 !bg-white': open,' -translate-y-3': !open }"></span>
                        <span aria-hidden="true" class="block absolute h-[0.2rem] w-[2rem] bg-tertiary-dark transform transition rounded-full duration-300 ease-in-out" :class="{'opacity-0': open } "></span>
                        <span aria-hidden="true" class="block absolute h-[0.2rem] w-[2.5rem] bg-tertiary-dark transform  transition rounded-full duration-300 ease-in-out" :class="{'-rotate-45 !bg-white': open, ' translate-y-3': !open}"></span>
                    </div>
                </div>
            </button>
        </div>

        
        <div class="fixed inset-x-0 top-0 z-50 w-screen h-screen overflow-scroll transition origin-top-right transform"
            x-show="open" @click.outside="open = false"
            x-transition:enter="duration-200 ease-out" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" x-transition:leave="duration-100 ease-in"
            x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
            <div class="w-full overflow-scroll">
                <div class="absolute top-0 left-0 flex flex-col w-full min-h-full bg-primary-contrast">
                    
                    <div class="absolute top-[0.8rem] right-0 z-10">
                        <button type="button" @click="toggleMenu()"
                            disabled x-bind:disabled="disabled"
                            class="relative h-[3rem] right-[0.7rem] bottom-[0.2rem] w-[3rem] m-4 text-white uppercase transition duration-150 ease-in-out bg-primary-accent focus:outline-none">
                        </button>
                    </div>
                    
    
        <div class="w-full px-6 pt-[1.5rem] pb-0">
            <a href="https://dutchlaravelfoundation.nl" class="flex justify-start w-full ">
                <img class="max-w-full max-h-[3rem] xl:max-h-full" src="/assets/img/logo.svg" alt="Home">
            </a>
        </div>
        <div class="h-10 border-b border-tertiary-dark opacity-20 mb-half"></div>
    

    
    
        <a href="/wat-is-laravel"
            class=" md:mt-[-1rem]  flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Wat is Laravel?</a>
    

    
    
        <a href="/over-ons"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Over ons</a>
    

    
    
        <a href="/leden"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Onze leden</a>
    

    
    
        <a href="/cases"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Cases</a>
    

    
    
        <a href="/insights"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Insights</a>
    

    
    
        <a href="/agenda"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Agenda</a>
    

    
    
        <a href="/contact"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Contact</a>
    

    
    
        <a href="/lid-worden"
            class=" flex w-full items-center h-auto px-10 py-4 border-b border-transparent hover:bg-primary-accent hover:text-white  ">Lid worden</a>
    

                </div>
            </div>
        </div>
    </div>
</header>



        <div id="content" class="container  pt-16 sm:pt-10 xl:pt-0 mt-10 sm:mt-20 lg:mt-20 xl:mt-52  px-6 lg:px-10 mb-auto mx-auto flex flex-col items-left justify-center">
    <article class="mb-half">
    <img src="/img/%20/assets/uploads/knowledge/graphql-met-laravel-en-lighthouse.png?fit=crop&w=1500&s=b6fac3d06d42c0d2ccc9ff285501dabb"
        class="object-cover w-full h-96 lg:h-[48rem] mb" style="object-position:50% 50%">
    <div class="relative w-full lg:w-11/12 lg:mx-auto bg-white lg:-mt-64 min-h-[10rem] px-6 sm:px-0 lg:p-10 z-10">
        <h1>GraphQL met Laravel en Lighthouse</h1>
        <p>In de wereld van moderne webontwikkeling zijn efficiënte en flexibele API's van cruciaal belang.<br />
Bij <a href="https://endeavour.nl">Endeavour</a> maken we daarom gebruik van GraphQL. Met deze krachtige query-taal kunnen onze frontend ontwikkelaars exact de data opvragen die zij nodig hebben. Zo wordt er geen onnodige data over de lijn gestuurd en kunnen we efficient nieuwe componenten ontwikkelen, zonder aanpassingen aan de API. Daarbij biedt <a href="https://graphql.org/">GraphQL</a> een belangrijke stap op het gebied van standaardisatie. Zo is de communicatie tussen de backend en de frontend voorspelbaar geworden en kunnen we ons focussen op het ontwikkelen van de wensen van de klant.</p>
<p>Met <a href="https://lighthouse-php.com/">Lighthouse</a> is het opzetten van een GraphQL API in Laravel erg eenvoudig! Het open-source pakket geeft ons het raamwerk waarmee we gemakkelijk onze GraphQL API kunnen opzetten. Het is de missende schakel die verzoeken naar de API interpreteert en navigeert naar de juiste stukken code binnen onze Laravel applicatie.</p>
<p>Ik neem je mee in de installatie en configuratie en laat je zien hoe je snel en gemakkelijk een API opzet!</p>
<h2>GraphQL concepten</h2>
<p>Voordat we beginnen is het belangrijk om een aantal basisconcepten van GraphQL en Lighthouse uit te leggen. Een GraphQL API bestaat feitelijk maar uit één endpoint, standaard is dat <code>/graphql</code>. Elke request naar de API gebruikt de <code>POST</code> methode, waarbij de request body de volgende JSON-structuur heeft:</p>
<pre><code class="language-json">{
    &quot;query&quot;: &quot;...&quot;,
    &quot;operationName&quot;: &quot;...&quot;,
    &quot;variables&quot;: { &quot;myVariable&quot;: &quot;someValue&quot;, ... }
}
</code></pre>
<p>Een GraphQL API geeft altijd een response met de volgende JSON-structuur, waarbij altijd een van de twee attributen aanwezig moet zijn:</p>
<pre><code class="language-json">{
  &quot;data&quot;: { ... },
  &quot;errors&quot;: [ ... ]
}
</code></pre>
<h3>Types</h3>
<p>In GraphQL zijn types een fundamenteel concept dat bepaalt welke soorten gegevens beschikbaar zijn in de API en hoe deze gegevens zijn gestructureerd. Elk GraphQL-schema is opgebouwd uit een set van deze types, die aangeven welke velden beschikbaar zijn en welk type waarde elk veld teruggeeft.</p>
<p>Er zijn verschillende soorten types in GraphQL:</p>
<ol>
<li>
<strong>Scalar types</strong>: Dit zijn de basistypes, zoals <code>Int</code>, <code>Float</code>, <code>String</code>, <code>Boolean</code>, en <code>ID</code>.</li>
<li>
<strong>Object types</strong>: Deze representeren complexe gegevens en bestaan uit velden die elk een specifiek type hebben. Bijvoorbeeld een <code>User</code> type met velden zoals <code>name</code> (van type <code>String</code>) en <code>age</code> (van type <code>Int</code>).</li>
<li>
<strong>Query en Mutation types</strong>: Dit zijn de toegangspunten voor het ophalen en wijzigen van gegevens in een GraphQL API. Een <code>Query</code> type wordt gebruikt voor het opvragen van gegevens, terwijl een <code>Mutation</code> type bedoeld is voor het aanpassen van gegevens.</li>
<li>
<strong>Input types</strong>: Deze worden gebruikt om gegevens in te voeren bij mutations. Ze lijken op object types, maar worden specifiek gebruikt om invoerparameters te definiëren.</li>
</ol>
<p>Types in GraphQL zorgen ervoor dat de API voorspelbaar en goed gedocumenteerd is, omdat elke query exact moet voldoen aan het type-schema dat is gedefinieerd.</p>
<h3>Schema</h3>
<p>Alle typedefinities bij elkaar noemen we het GraphQL Schema. Het is de blauwdruk van de API en beschrijft de structuur en functionaliteiten van de API. In Lighthouse bouwen we het schema op in het <code>graphql/schema.grapqhl</code> bestand dat we bij de installatie gaan genereren.</p>
<h3>Directives</h3>
<p><a href="https://lighthouse-php.com/6/the-basics/directives.html#directives">Directives</a> zijn binnen Lighthouse de primaire manier om functionaliteiten aan onze GraphQL API toe te voegen. Ze zijn gemakkelijk te herkennen, omdat ze altijd beginnen met een <code>@</code>. Directives kunnen op verschillende plekken in het schema worden toegepast.</p>
<h2>Installeren en configureren</h2>
<p>Alright, het stukje theorie hebben we gehad. We kunnen beginnen met het installeren van de benodigde pakketjes!</p>
<blockquote>
<p>Mocht je deze stap over willen slaan en direct aan de slag willen met het maken van queries en mutations, clone<br />
dan <a href="https://github.com/dennis-koster/dlf-graphql-example">deze repository</a> en volg de instructies uit de readme.</p>
</blockquote>
<p>We beginnen met het opzetten van een nieuw Laravel project en de installatie van Lighthouse.</p>
<pre><code class="language-shell">composer create-project laravel/laravel dlf-graphql-example
cd dlf-graphql-example
composer require nuwave/lighthouse
</code></pre>
<p>Vervolgens publiceren we het <code>schema.graphql</code> bestand in het mapje <code>graphql</code>. In dit bestand definiëren we al onze queries en mutations, vergelijkbaar met een route bestand, zoals je die van Laravel kent.</p>
<pre><code class="language-shell">php artisan vendor:publish --tag=lighthouse-schema
</code></pre>
<p>We helpen onze IDE een handje om de Lighthouse-specifieke syntax te begrijpen, door het genereren van een <code>_lighthouse_ide_helper.php</code> bestand.</p>
<pre><code class="language-shell">php artisan lighthouse:ide-helper
</code></pre>
<p>Tot slot installeren we een interactieve GraphQL Playground, die we gaan gebruiken om API calls te maken. Deze is standaard te bereiken op <code>http://&lt;APP_URL&gt;/graphiql</code>.</p>
<pre><code class="language-shell">composer require mll-lab/laravel-graphiql --dev
</code></pre>
<h2>Data ophalen uit de GraphQL API</h2>
<p>We zijn klaar om onze eerste API call maken! Onze basisinstallatie van Laravel en Lighthouse komt, out of the box, met twee queries om gebruikers op te halen. Deze vind je in <code>graphql/schema.graphql</code>.</p>
<pre><code class="language-graphql">type Query {
    &quot;Find a single user by an identifying attribute.&quot;
    user(
      &quot;Search by primary key.&quot;
      id: ID @eq @rules(apply: [&quot;prohibits:email&quot;, &quot;required_without:email&quot;])

      &quot;Search by email address.&quot;
      email: String @eq @rules(apply: [&quot;prohibits:id&quot;, &quot;required_without:id&quot;, &quot;email&quot;])
    ): User @find

    &quot;List multiple users.&quot;
    users(
      &quot;Filters by name. Accepts SQL LIKE wildcards `%` and `_`.&quot;
      name: String @where(operator: &quot;like&quot;)
    ): [User!]! @paginate(defaultCount: 10)
}
</code></pre>
<p>Navigeer naar de GraphQL Playground en voer de <code>users</code> query uit:</p>
<p><img src="https://raw.githubusercontent.com/dennis-koster/dlf-graphql-example/refs/heads/main/docs/users-query.gif" alt="Users query" /></p>
<p>De <a href="https://lighthouse-php.com/6/api-reference/directives.html#paginate"><code>@paginate</code></a> directive zorgt ervoor dat resultaten gepagineerd worden teruggegeven. Met de <code>paginatorInfo</code> kunnen we zien hoeveel resultaten er in totaal zijn en hoeveel pagina's er zijn. Vervang je deze directive met de <a href="https://lighthouse-php.com/6/api-reference/directives.html#all"><code>@all</code></a> directive, dan krijg je alle resultaten terug.</p>
<h3>Meerdere queries in één request</h3>
<p>Een van de grootste voordelen van GraphQL is het bundelen <a href="https://graphql.org/#single-request">van meerdere queries</a>. Met één request naar de API kan daarmee alle data opgevraagd worden die nodig is.</p>
<pre><code class="language-graphql">query {
    # Van de eerste tien gebruikers willen we de ids hebben
    users(first: 10, page: 1) {
        data {
            id
        }
    }

    # Van de gebruiker met id 1 willen we gedetailleerde informatie
    user(id: &quot;1&quot;) {
        id
        name
        email
        created_at
        updated_at
    }
}
</code></pre>
<h2>Data aanmaken via GraphQL API</h2>
<p>We weten nu hoe we data ophalen, maar hoe bewerken we data via de API? In GraphQL doen we dat met <a href="https://graphql.org/learn/queries/#mutations">mutations</a>. We gaan een mutation maken waarmee we een nieuwe gebruiker kunnen maken.</p>
<p>Open het <code>schema.graphql</code> bestand in de <code>graphql</code> map en plak daarin de volgende code:</p>
<pre><code class="language-graphql">type Mutation {
    register(input: RegisterInput! @spread): User! @create
}

input RegisterInput {
    name: String!
    email: String! @rules(apply: [&quot;email&quot;, &quot;unique:users,email&quot;])
    password: String! @rules(apply: [&quot;min:8&quot;])
}
</code></pre>
<p>Open nu weer de GraphQL playground en voer de mutation uit:</p>
<p><img src="https://raw.githubusercontent.com/dennis-koster/dlf-graphql-example/refs/heads/main/docs/create-user-mutation.gif" alt="Create user mutation" /></p>
<p>Met een paar regels code hebben we een mutation aangemaakt, waarmee we nieuwe gebruikers kunnen registreren.</p>
<h2>Geavanceerde use cases</h2>
<p>Met de standaard directives komen we een heel eind, zonder ook maar een regel PHP-code te schrijven. Natuurlijk dekken deze lang niet alle denkbare scenarios en kun je ook jouw eigen logica schrijven.</p>
<h3>Maatwerk mutation</h3>
<p>Als voorbeeld nemen we een beheerpaneel voor admins. Via dit paneel moet het mogelijk zijn om het wachtwoord van een gebruiker te resetten. We willen zelf het nieuwe wachtwoord kunnen specificeren, maar als deze niet wordt meegegeven willen we dat de API een willekeurig wachtwoord genereert.</p>
<p>Zoals voorheen openen we het <code>schema.graphql</code> bestand en vervolgens voegen we de volgende code toe:</p>
<pre><code class="language-graphql">extend type Mutation {
    resetUserPassword(input: ResetUserPasswordInput! @spread): String! @field(resolver: &quot;App\\GraphQL\\Mutations\\ResetUserPassword&quot;)
}

input ResetUserPasswordInput {
    id: ID! @rules(apply: [&quot;exists:users,id&quot;])
    password: String @rules(apply: [&quot;min:8&quot;])
}
</code></pre>
<p>Met de <code>@field</code> directive verwijzen we naar de PHP class die verantwoordelijk is voor het afhandelen van deze mutation. Deze class bestaat nog niet, dus laten we die creëren.</p>
<p><code>app/GraphQL/Mutations/ResetUserPassword.php</code>:</p>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\GraphQL\Mutations;

use App\Models\User;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

class ResetUserPassword
{
    public function __invoke($_, array $args): string
    {
        $user     = User::findOrFail($args['id']);
        $password = $args['password'] ?? Str::random(8);

        $user-&gt;update([
            'password' =&gt; Hash::make($password),
        ]);

        // Logic for sending an email to the user here

        return &quot;Wachtwoord is gereset naar {$password}.&quot;;
    }
}
</code></pre>
<p>Voer vervolgens de volgende API call uit en kijk wat er gebeurt!</p>
<p><img src="https://raw.githubusercontent.com/dennis-koster/dlf-graphql-example/refs/heads/main/docs/reset-password-mutation.gif" alt="Reset user password" /></p>
<h3>Maatwerk query</h3>
<p>Een query hoeft niet altijd iets uit een database terug te geven. Het kan bijvoorbeeld nuttig zijn om een query te hebben die het versienummer van de API teruggeeft, die wordt uitgelezen uit het <code>composer.json</code> bestand.</p>
<p>We doen dat door wederom gebruik te maken van de <code>@field</code> directive.</p>
<pre><code class="language-graphql">extend type Query {
    apiVersion: String! @field(resolver: &quot;App\\GraphQL\\Queries\\ApiVersion&quot;)
}
</code></pre>
<p>Maak vervolgens de class aan die verantwoordelijk is voor het afhandelen van de query logica.</p>
<p><code>app/GraphQL/Queries/ApiVersion.php</code>:</p>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\GraphQL\Queries;

class ApiVersion
{
    public function __invoke($_, array $args): string
    {
        $composerContents   = file_get_contents(dirname(__DIR__, 3) . DIRECTORY_SEPARATOR . 'composer.json');
        $composerAttributes = json_decode($composerContents, true);

        return $composerAttributes['version'] ?? 'onbekend';
    }
}
</code></pre>
<p>Zorg ervoor dat je <code>composer.json</code> bestand een <code>version</code> gedefinieerd heeft en probeer de query uit te voeren.</p>
<pre><code class="language-graphql">query {
    apiVersion 
}
</code></pre>
<h3>Queries uitbreiden</h3>
<p>Soms doen de standaard directives <strong>bijna</strong> wat je wil, maar wil je de uitgevoerde query kunnen beïnvloeden. Ik laat je zien hoe!</p>
<p>Laten we de <code>users</code> query weer als voorbeeld pakken. We willen de pagination behouden, maar we willen alleen gebruikers terugkrijgen die na een opgegeven datum zijn aangemaakt.</p>
<p>Open het <code>schema.graphql</code> bestand en pas de <code>users</code> query aan als volgt:</p>
<pre><code class="language-graphql">users(
  &quot;Filters by name. Accepts SQL LIKE wildcards `%` and `_`.&quot;
  name: String @where(operator: &quot;like&quot;)

  &quot;Filters by created_at.&quot;
  createdAfter: DateTime
): [User!]! @paginate(defaultCount: 10, builder: &quot;App\\GraphQL\\Builders\\UsersBuilder&quot;)
</code></pre>
<p>Maak daarna de <a href="https://lighthouse-php.com/6/api-reference/directives.html#custom-builder">custom builder class</a> aan.</p>
<p><code>app/GraphQL/Builders/UsersBuilder.php</code>:</p>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\GraphQL\Builders;

use App\Models\User;
use Illuminate\Database\Eloquent\Builder;

class UsersBuilder
{
    public function __invoke($_, array $args): Builder
    {
        $builder = User::query();

        if (isset($args['createdAfter'])) {
            $builder-&gt;where('created_at', '&gt;=', $args['createdAfter']);
        }

        return $builder;
    }
}
</code></pre>
<p>De query accepteert nu, naast de argumenten voor de paginering, ook het <code>createdAfter</code> argument. Het argument wordt uitgelezen in de builder class, die de database query uitbreidt en vervolgens de eloquent query instantie teruggeeft.</p>
<pre><code class="language-graphql">query {
    users(first: 10, page: 1, createdAfter: &quot;2024-09-18 11:10:00&quot;) {
        data {
            id
            name
            created_at
        }
    }
}
</code></pre>
<h3>Authenticatie en autorisatie</h3>
<p>Bij het uitlezen en aanpassen van gebruikers, zoals in de voorbeelden hierboven, is een solide authenticatie en autorisatie flow onmisbaar. Lighthouse biedt daarvoor een oplossing middels de <a href="https://lighthouse-php.com/6/api-reference/directives.html#guard">@guard</a> en de <a href="https://lighthouse-php.com/6/api-reference/directives.html#can">@can</a> directives, die gebruik maken van Laravel's guards en policies. Een uitstekende plugin is <a href="https://github.com/joselfonseca/lighthouse-graphql-passport-auth">joselfonseca/lighthouse-graphql-passport-auth</a>, wanneer je gebruik wilt maken van <a href="https://laravel.com/docs/11.x/passport">Laravel Passport</a>. Dankzij <a href="https://github.com/daniel-de-wit/lighthouse-sanctum">daniel-de-wit/lighthouse-sanctum</a> kun je snel aan de slag met met <a href="https://laravel.com/docs/11.x/sanctum#main-content">Laravel Sanctum</a>.</p>
<h3>De diepte in</h3>
<p>Een GraphQL API opzetten is met Lighthouse een fluitje van een cent. De behandelde scenarios geven je hopelijk een goede basis om mee te starten, maar Lighthouse is erg uitgebreid. De <a href="https://lighthouse-php.com/6/getting-started/installation.html">documentatie</a> is een goed startpunt wanneer je verder de diepte in wil. Er zijn tevens <a href="https://lighthouse-php.com/resources/#plugins">tal van plugins</a> die de standaardfunctionaliteiten van Lighthouse uitbreiden.</p>
<p>Voor vragen die niet in de documentatie behandeld zijn kun je altijd een bericht plaatsen op de <a href="https://github.com/nuwave/lighthouse/discussions">Discussions</a> sectie van Lighthouse's github pagina. Voel je tevens vrij om mij een berichtje te sturen op <a href="https://www.linkedin.com/in/dennis-koster-688b7b48/">LinkedIn</a> als je ergens niet uitkomt!</p>
<h3>Over de auteur</h3>
<p>Dit artikel werd geschreven door <a href="https://www.linkedin.com/in/dennis-koster-688b7b48/">Dennis Koster</a>, Lead Developer bij <a href="https://endeavour.nl">Endeavour</a> en bestuurslid bij de Dutch Laravel Foundation. Endeavour is een van onze founding partners en expert op het gebied van GraphQL.</p>

    </div>
</article>
<div class="flex w-full px-6 mx-auto mb lg:w-11/12 sm:px-0 lg:px-10">
    
<a   class="relative flex h-12 items-center justify-center group " href="/knowledge">
    <div class="text-xs uppercase whitespace-nowrap px-8 font-bold flex items-center justify-center w-full h-full transition-transform group-hover:-translate-x-1 group-hover:-translate-y-1 z-20 bg-primary-contrast !text-tertiary-dark border border-primary-accent ">Naar alle kennis</div>
    <div class="absolute bottom-0 right-0 w-full h-full border z-10 border-primary-accent "></div>
</a>
</div>
</div>
        <footer
    class="container relative mx-auto sm:px-6 lg:px-10 ">
    
    <div class="px-6 lg:px-10 pb-10 bg-secondary-light  pt-6 lg:pt-10 ">
        <h2 id="footer-title" class="mb-2 text-[25px] lg:text-[48px] font-bold text-primary-accent lg:mb-10 xl:mb-2">Dutch Laravel Foundation</h2>
        <nav class="hidden w-full h-16 mb-10 space-x-10 align-middle xl:flex">
            




    
        
        
        <a href="/"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Home</a>
    

    
        
        
        <a href="/wat-is-laravel"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Wat is Laravel?</a>
    

    
        
        
        <a href="/over-ons"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Over ons</a>
    

    
        
        
        <a href="/leden"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Onze leden</a>
    

    
        
        
        <a href="/cases"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Cases</a>
    

    
        
        
        <a href="/insights"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Insights</a>
    

    
        
        
        <a href="/agenda"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Agenda</a>
    

    
        
        
        <a href="/contact"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Contact</a>
    

    
        
        
        <a href="/lid-worden"
            class="block h-auto my-auto border-b border-transparent hover:text-inherit hover:border-primary-accent font-normal">Lid worden</a>
    

        </nav>
        <div class="flex flex-col">
            <h4 class="hidden lg:block">Leden</h4>
            <div class="flex-col justify-between hidden mb-5 sm:flex md:flex-row">
                <div class="hidden w-full lg:block md:w-7/12">
                    <div class="columns-2 lg:columns-3 2xl:columns-4 4xl:columns-5">
                        <ul class="list-none">
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/1a-first-alternative">1A First Alternative</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/23g">23G</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/bitfactory">Bitfactory</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/blauwfruit">blauwfruit</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/clarity">Clarity</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/cloud-plus-plus">Cloud++</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/cyberfusion">Cyberfusion</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/dij">DIJ</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/ef2">EF2</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/emble">Emble</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/endeavour">Endeavour</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/enrise">Enrise</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/goedemiddag">Goedemiddag!</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/lajos-nl">Lajos.nl</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/no-pulp">No Pulp</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/noardcode">NoardCode</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/orangetalent">OrangeTalent</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/paqt">PAQT</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/pionect">Pionect</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/platform11">Platform11</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/rl-webdiensten">RL Webdiensten</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/september">September</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/sqits">Sqits</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/studio-fifteen">Studio Fifteen</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/swis">SWIS</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/synetic">Synetic</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/vormkracht10">Vormkracht10</a></li>
                            
                            <li class="pl-0 marker:content-[]"><a href="/leden/web-whales">Web Whales</a></li>
                            
                        </ul>
                    </div>
                </div>
                <div class="w-full pl-0 lg:w-5/12 lg:pl-10 flex-flex-col">
                    <div class="w-full mb-5 md:w-3/4 lg:w-full">
                        De Dutch Laravel Foundation zorgt voor de promotie van Laravel en stimuleert
                        kennisuitwisseling tussen Laravel developers in Nederland.
                    </div>
                    <div class="flex flex-row items-center mb-10 space-x-4">
                        
                            <a href="https://www.linkedin.com/company/dutch-laravel-foundation" target="_blank"><img src="/assets/uploads/socials/linkedin.svg"></a>
                        
                            <a href="https://www.meetup.com/nl-NL/meetup-group-NBzJdgRH/" target="_blank"><img src="/assets/uploads/socials/iconmeetup@3x.svg"></a>
                        
                            <a href="https://twitter.com/dutchlaravel" target="_blank"><img src="/assets/uploads/socials/icontwitter@3x.svg"></a>
                        
                    </div>
                    <div class="w-full md:w-1/2 lg:w-full">
                        <h4>Aanmelden nieuwsbrief</h4>
                        
                        
                            
                                <input type="text" class="hidden" name="honeypot">
                                
                                <form method="POST" action="https://dutchlaravelfoundation.nl/!/forms/newsletter"><input type="hidden" name="_token" value="STATAMIC_CSRF_TOKEN">
                                    <div class="flex flex-row w-full">
                                        
                                            <input
    type="text"
    name="email"
    value=""
    placeholder="Jouw e-mailadres"
    
    
    required
 style='background-color:#fff !important;'>
                                        
                                        
<button type="submit"  class="relative flex h-12 items-center justify-center group " >
    <div class="text-xs uppercase whitespace-nowrap px-8 font-bold flex items-center justify-center w-full h-full transition-transform group-hover:-translate-x-1 group-hover:-translate-y-1 z-20 bg-tertiary-dark text-white w-12 !px-0"><img src="/assets/img/icons/send.svg" alt="Aanmelden" class="mx-5"></div>
    <div class="absolute bottom-0 right-0 w-full h-full border z-10 border-tertiary-dark "></div>
</button>
                                    </div>
                                </form>
                            
                        
                        
                    </div>
                </div>
            </div>
            <div class="flex flex-col justify-between md:flex-row">
                <div class="w-full md:w-7/12">
                    
                        <a href="/privacy-statement">Privacy statement</a>
                        
                    
                    <br><br>
                    <a href="https://www.leadinfo.com/nl/" target="_blank" style="display: inline-block"><img src="/assets/img/leadinfo.png" alt="Leadinfo" style="height: 45px; margin-right: 10px;"></a>
                    <a href="https://www.larabelles.com/" target="_blank" style="display: inline-block"><img src="/assets/img/larabelles.png" alt="Larabelles" style="height: 45px"></a>
                </div>
                <div class="w-full pl-0 md:w-5/12 lg:pl-10 text-left: lg:text-right">
                    &copy 2024 - Dutch Laravel Foundation | <a href="https://vormkracht10.nl" class="text-primary-text hover:text-primary-text" title="Gerealiseerd door het team van Vormkracht10" target="_blank">VK<span class="!text-primary-accent">10</span></a>
                </div>
            </div>
        </div>
    </div>

    
    <div class="absolute bottom-[18rem] right-[-5rem] md:right-[-25rem] z-[-1] w-screen flex justify-end">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1129 908" class="w-[1120px] h-[900px]">
        <g fill="none" stroke="#ECECEC" opacity=".5">
            <path d="m225.8 476.687 74.255 42.237-74.255 42.238-74.255-42.238 74.255-42.237Zm0-102.562 74.255 42.238L225.8 458.6l-74.255-42.237 74.255-42.238Z"/>
            <path d="m225.8 303.556 74.255 42.237L225.8 388.03l-74.255-42.237 74.255-42.237Zm-75.267 43.282 74.256 42.238-74.256 42.237-74.255-42.237 74.255-42.238Zm225.8 59.279 74.256 42.237-74.256 42.238-74.255-42.238 74.255-42.237Zm150.534-15.996 74.255 42.238-74.255 42.237-74.256-42.237 74.256-42.238Zm150.533 0 74.255 42.238-74.255 42.237-74.255-42.237L677.4 390.12Zm150.533 0 74.256 42.238-74.256 42.237-74.255-42.237 74.255-42.238Zm-526.866-43.283 74.255 42.238-74.255 42.237-74.256-42.237 74.256-42.238Zm150.533 0 74.255 42.238-74.255 42.237-74.255-42.237 74.255-42.238Zm150.533 0 74.256 42.238-74.256 42.237-74.255-42.237 74.255-42.238Zm150.534 0 74.255 42.238-74.255 42.237-74.256-42.237 74.256-42.238Zm150.533 0 74.255 42.238-74.255 42.237-74.255-42.237 74.255-42.238Z"/>
            <path d="m451.6 433.404 74.255 42.237L451.6 517.88l-74.255-42.238 74.255-42.237ZM376.333 216.99l74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237ZM677.4 303.556l74.255 42.237L677.4 388.03l-74.255-42.237 74.255-42.237Zm-301.067 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm150.534 0 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm75.266 129.848 74.256 42.237-74.256 42.238-74.255-42.238 74.255-42.237Zm225.8-113.853 74.256 42.238-74.256 42.237-74.255-42.237 74.255-42.238Zm-526.866-59.278 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm301.066 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm150.534 0 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm150.533 0 74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Z"/>
            <path d="m451.6 244.277 74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm225.8-27.287 74.255 42.237-74.255 42.237-74.255-42.237L677.4 216.99Z"/>
            <path d="m526.867 216.99 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm301.066 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm-451.6 432.829 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm150.534 0 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm150.533 0 74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm150.533 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237ZM451.6 606.536l74.255 42.237L451.6 691.01l-74.255-42.237 74.255-42.237Zm150.533 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm150.534-15.996 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237ZM903.2 606.536l74.255 42.237L903.2 691.01l-74.255-42.237 74.255-42.237ZM451.6 709.098l74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm-75.267-232.411 74.256 42.237-74.256 42.238-74.255-42.238 74.255-42.237Z"/>
            <path d="m677.4 563.253 74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm-301.067 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm150.534-15.996 74.255 42.237-74.255 42.238-74.256-42.238 74.256-42.237Zm75.266 145.845 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm225.8-129.849 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Z"/>
            <path d="m602.133 519.97 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm150.534 0 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm150.533 0 74.255 42.237-74.255 42.237-74.255-42.237L903.2 519.97Zm-451.6 0 74.255 42.237-74.255 42.237-74.255-42.237L451.6 519.97Zm225.8-43.283 74.255 42.237-74.255 42.238-74.255-42.238 74.255-42.237Zm-150.533 0 74.255 42.237-74.255 42.238-74.256-42.238 74.256-42.237Zm301.066 0 74.256 42.237-74.256 42.238-74.255-42.238 74.255-42.237Zm-75.266-43.283 74.255 42.237-74.255 42.238-74.256-42.238 74.256-42.237Zm-451.6 0 74.255 42.237-74.255 42.238-74.256-42.238 74.256-42.237Zm0 173.132 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm225.8 129.849 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm150.533 0 74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm150.533 0 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237ZM903.2 433.404l74.255 42.237L903.2 517.88l-74.255-42.238 74.255-42.237ZM451.6 173.707l74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm-75.267-43.283 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237ZM903.2 173.707l74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Z"/>
            <path d="m978.467 146.42 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm-451.6-15.996 74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237ZM677.4 114.428l74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Z"/>
            <path d="m602.133 87.141 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm0-86.566 74.256 42.237-74.256 42.238-74.255-42.238L602.133.575Zm0 173.132 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237ZM301.067 519.97l74.255 42.237-74.255 42.237-74.256-42.237 74.256-42.237Zm-225.8-43.283 74.255 42.237-74.255 42.238L1.01 518.924l74.256-42.237Zm301.066 259.698 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237Zm-150.533 0 74.255 42.237-74.255 42.237-74.255-42.237 74.255-42.237Zm451.6 86.565 74.255 42.238-74.255 42.237-74.255-42.237L677.4 822.95Zm376.333-389.546 74.256 42.237-74.256 42.238-74.255-42.238 74.255-42.237ZM75.267 303.556l74.255 42.237-74.255 42.237L1.01 345.793l74.256-42.237Zm978.466 302.98 74.256 42.237-74.256 42.237-74.255-42.237 74.255-42.237ZM451.6.575l74.255 42.237L451.6 85.05l-74.255-42.238L451.6.575Z"/>
        </g>
        </svg>
    </div>
</footer>

    </div>

    
            <script>
                if (document.querySelectorAll('form input[name="_token"]').length > 0) {
                    async function setToken() {
                        let token = await fetch('/!/DynamicToken/refresh')
                            .then((res) => res.json())
                            .then((data) => { 
                                return data.csrf_token 
                            })
                            .catch(function (error) {
                                console.error('Error:', error)
                            })
                        document.querySelectorAll('form input[name="_token"]').forEach(function(item) {
                            item.value = token
                        });
                    }
            
                    setToken()
            
                    setInterval(setToken, 15 * 60 * 1000)
                }
            </script>
        
    <script src="/assets/js/site.js?id=e6c347ee91da90d5d7ecfb16480d17b1"></script>
        <script type="text/javascript">
      window.recaptchaV3 = {};
      window.recaptchaV3.siteKey = '6LelMtUgAAAAADnf5qwyvZwlPXzFT4RG0Xdd5Z-0';
      window.recaptchaV3.action = 'knowledge/graphql_met_laravel_en_lighthouse';
      window.recaptchaV3.verifyOnPageLoad = true;
    </script>
    <script src="/vendor/statamic-recaptcha/js/recaptcha-v3.js"></script>
<script type="text/javascript">var els = document.getElementsByClassName('nocache');
var map = {};
for (var i = 0; i < els.length; i++) {
    var section = els[i].getAttribute('data-nocache');
    map[section] = els[i];
}

fetch('/!/nocache', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        url: window.location.href,
        sections: Object.keys(map)
    })
})
.then((response) => response.json())
.then((data) => {
    const regions = data.regions;
    for (var key in regions) {
        if (map[key]) map[key].outerHTML = regions[key];
    }

    for (const input of document.querySelectorAll('input[value=STATAMIC_CSRF_TOKEN]')) {
        input.value = data.csrf;
    }

    for (const meta of document.querySelectorAll('meta[content=STATAMIC_CSRF_TOKEN]')) {
        meta.content = data.csrf;
    }
});</script></body>

</html>
